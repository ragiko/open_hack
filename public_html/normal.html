<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <title>おさかな天国</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <!-- Le styles -->
    <link href="/bower_components/bootstrap/dist/css/bootstrap.css" rel="stylesheet">
    <style>
      body {
      padding-top: 70px;
      padding-bottom: 30px;
      }
      #left {
        width:800px;
        height:70%;
        float:left;
      }
      #rare_eria {
        width:400px;
        height:70%;
      }
      #histories {
        float:both;
        height:15%;
      }
    </style>
  </head>

  <body>
    <!-- Fixed navbar -->
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <a class="navbar-brand" href="/toppage.html">おさかな天国</a>
        </div>
      </div>
    </div>
    <div id= "main" class="container">
      <div id="left">
        <div id="result"><h3 v-text="result"></h3></div>
         <button class="btn bttn-lg btn-default" v-on="click: gacha()">ガチャ！</button>
      </div>
      <div id="rare_eria">
        <h3>未取得ガチャ</h3>
        <ul v-text="allList">
          <li></li>
        </ul>
      </div>
      <div id="histories">
        <h3>ガチャ履歴</h3>
        <p v-text="hist"></p>
      </div>
	   <footer>
      <p>&copy; Yuta Iwamoto 2014</p>
	   </footer>
    </div> <!-- /container -->
    <script  type="text/javascript" src="http://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script src="/bower_components/vue/dist/vue.js"></script>
    <script src="/bower_components/underscore/underscore.js"></script>
    <script src="/bower_components/bootstrap/dist/js/bootstrap.js"></script>
    <script>
      (function(Vue){
        window.app = new Vue({
          el: '#main',
          data:{
            item: '',
            hist:[],
            allList:[],
            collection:[],
            result:'',
            error:''
          },
          ready: function(){
            var jqxhr = $.ajax({
              url: 'fishgachas.json',
              context: this,
              dataType: 'json'
            })
            .done(function(jqxhr){
              for(var i in jqxhr){
                this.allList.push(jqxhr[i].key);
              }
            })
            .fail(function(){
              this.error = 'ガチャは使えません。';
            });
            return jqxhr;
          },
          methods: {
            gacha: function() {
              this.draw();
              this.result = this.item;
              this.addHistory(this.item);
              this.list(this.allList);
            },
            draw: function() { 
              var jqxhr = $.ajax({
                url: 'fishGet.json',
                context: this,
                dataType: 'json'
              })
              .done(function(jqxhr){
              this.item = jqxhr.key;
              return jqxhr.key;
              })
              .fail(function(){
                this.error = 'ガチャが壊れた.';
              });
            },
            addHistory: function(item){
              this.hist.unshift(item);
            },
            list: function(allList){
              for(var i in allList){
                if (allList[i].value == 0) {
                  this.collection.push(allList[i].key);
                };
              }
              console.log(this.collection);
            },
          }
        });
      })(Vue);
      </script>
  </body>
</html>
